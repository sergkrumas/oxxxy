
## Интересные факты

- разработка велась исподволь с июня 2021 года по май 2022 года, бетатестирование с мая 2022 по середину декабря 2022
- под конец работы над этим проектом при исследовании файлов скриншотера Joxi внезапно обнаружилось, что он тоже написан с использованием Qt, только уже на C++
- *производительность или зачем писать Qt-приложения на Python*: если б я писал это всё на C++, то, чувствую, что провозился ещё дольше. На Python пробовать, разрабатывать и отлаживать проще, удобней и быстрей. Ну и, если представить меня, автора кода и автора идеи, в виде пары пользователь+программист, то практичный пользователь однозначно взял верх и ему глубоко насрать как оно там внутри, главное ведь работает же! Ну и пока Oxxxy это не то приложение, в котором производительность играет серьёзную роль.
- отличия от оригинала:
   - клон не умеет делать скриншоты с прокруткой
   - созданный скриншот не отравляется никуда, тем более не предусмотрена даже интеграция с каким-либо из облачных сервисов для хранения изображений и файлов
   - нижняя панель под панелью инструментов не скрывается под неё
   - кнопка **Готово** чуть меньшей высоты, чем сама панель инструментов

## Что планируется сделать дальше?
  - **Основное**
      - !!! переделать виджет для инструмента **Текст**, чтобы в режиме редактирования при повороте через клавиши F5-F6 одновременно с основной не отображалась повёрнутая версия
      - !!! переработать виджет трансформации для всех видов трансформации абсолютно всех пометок
      - !!! добавить возможность трансформации нескольких выделенных пометок (например, с целью перемещения)
      - реализовать намного более точное выделение объектов для инструмента **Перемещение**, а не по bounding box объекта как сейчас
  - !!! пересмотреть и переработать UX и UI в свете того, что Oxxxy отныне является редактором коллажей
  - добавить поддержку хорд для инструмента **Овал**
  - рассмотреть необходимость добавления направляющих типа линейки и транспортира как в скриншотере Windows 10
  - добавить инструмент **для нанесения изогнутых стрелок, срастающихся в основании**. Такие стрелки можно наблюдать на картах военных действий и в инфографике
  - добавить ещё три языка кроме Русского для UI: Немецкий, Французский и Английский
  - добавить возможность менять размеры шрифтов в UI
  - оформить ядро программы в отдельный python-модуль для встраивания в любые PyQT-приложения
  - перейти с PyQt5 на PyQt6
  - капитально отрефакторить код
  - записать видео на Youtube для пользователей
  - добавить возможность записывать видео со звуком или гифки в захваченной области (через расширение на Си)
  - тестирование и обеспечение работы в виртуальном окружении
  - содать версию приложения в виде единого бинарника для Windows
  - протестировать работу приложения в Ubuntu

## Changelog, История нововведений
### Версия 0.90 (24 декабря 2022) Первая релизная версия

### Версия 0.91 (26 декабря 2022)
  - Инструмент **Размытие** получил галочку "Пикселизация"
  - Инструмент **Линия** теперь может рисовать ломанные линии при удерживании клавиши Ctrl. Каждый сегмент линии создаётся как отдельная пометка

### Версия 0.92 (12 мая 2023)
  - Ликвидирвоана зависимость от забагованного питоновского модуля `pynput`. Теперь есть надежда, что на линуксах будут работать сочетания клавиш
  - У программы появилось отдельное окно с настройками, в котором можно:
      - заменить слайдер цвета на палитру предопределённых цветов
      - задать общий стиль панели инструментов — с градиентами или без них, т.е. flat
      - задавать путь к хранилищу, в которое будут сохраняться скриншоты
      - включить или выключить автозагрузку приложения в трей при старте Windows
      - менять сочетания клавиш для разных вариантов работы над скриншотом
      - по желанию блокировать дальнейшие нажатия комбинаций клавиш после запуска редактора скриншотера. Это позволит запускать один скриншотер поверх другого
      - разрешить нажатию по единственной клавише Print Screen вызывать редактор скриншотера, в таком случае комбинация Ctrl+Print или изменённая пользовательская тоже будут работать

      ![](docs/settings_window_0.92.png)
  - Теперь пометки инструментов **Линия**, **Маркер** и **Карандаш** автоматически удаляются, если курсор мышки не двигался за всё время нанесения пометки. Проблема была в том, что если имело место такая ситуация, то такая пометка толком не отрисовываются, однако всё же остаеётся в истории действий. Нахождение таких пометок в истории могло бы вызвать конфуз при использовании **Ctrl+Z**, потому что отмена идёт, а на экране ничего не меняется, поэтому и было внесен данное исправление.
  - Внедрён инструмент **мультикадрирования**. Активируется он уже через контексное меню в пункте «Активировать инструмент мультикадрирования». Затем мышкой предлагается задать произвольное количество прямоугольных областей, которые после нажатии на кнопку «Готово» соберутся вертикально друг за другом в единую картинку. Иногда это может пригодиться как инструмент для создания коллажа, а иногда для того, чтобы сделать серию изображений, на которой масштаб постепенно приближается к точке интереса.
  - Внедрён расширинный режим редактора для создания коллажей из готовых картинок и пометок поверх них
    - теперь можно перемещаться по холсту с зажатым **Alt** и левой кнопкой мыши, масштабирование отсутствует — об этом ниже
    - отныне можно задавать область захвата, которая будет выходить за пределы фона
    - через клавишу **P** можно смотреть на финальный результат в специальном просмоторщике, где можно приближаться к картинке и перемещать по ней в разные стороны. Это компенсирует то, что в самом редакторе невозможно приближаться и отдаляться. Контекстное меню содержит все требуемые команды для работы с просмоторщиком
    - в этом режиме касательные линии прямоугольника захвата теперь рисуются пунктирными линиями в режиме XOR для большей контрастности с фоном
    - расширенный режим всегда можно выключить или включить через чекбокс в контестном меню
    - полупрозрачная шахматная подложка теперь рисуется под фоном скриншота и за его пределами
  - В дополнение к 3м опциям по вызову скриншотера в меню трея стала доступна ещё 4я под названием «Коллаж». Комбинация клавиш не назначена для неё.
      После клика будет открыт файловый диалог для выбора произвольного количества файлов. В файловом диалоге всегда открывается папка, которая задана в настройках как хранилище для скриншотов
  - Исправлены баги
    - окно с уведомлением о создании скриншота при появлении на экране больше не забирает на себя фокус
  - При использовании Канадской многоязычной раскладки в Windows никак не работали комбинации клавиш с правым **Ctrl**, приходилось зажимать намного более неудобный левый **Ctrl**. В итоге перебрав разные варианты решения проблемы теперь нажатие по клавише **Print Screen** делает то же самое, что и нажатие сочетания клавиш **Ctrl+Print Screen**
  - Добавлены новые команды в **контексное меню**
      - **«Сбросить область захвата»** позволяет задать область захвата заново, как это делается в самом начале перед появлением панели инструментов. Клавиша **Esc** возвращает прежнюю область захвата на случай, если вы передумаете её менять.
      - **«Подтянуть панель инструментов»** позволяет панели инструментов оказаться рядом с курсором мыши, если она уехала за область видимости, что бывает актуально в расширенном режиме.
      - **«Задать область захвата»** задаёт область захвата на основе позиции и габаритов всех пометок таким образзом, чтобы они все поместились в неё с некоторым запасом в десяток пикселей по бокам.
      - **«Автоколлаж»** разместит пометки-картинки либо вертикально, либо горизонтально. Желательный порядок картинок задаётся их положением друг относительно друга по горизонтали. Все картинки подгоняются по размеру под самую большую, при этом учитывается предшествующее кадрирование изображения. Область захвата будет автоматически поправлена, учитывая совокупный размер коллажа по двум осям. Хоть картинки и будут обрабатываться каждая по-своему отдельно, система истории будет воспринимать такую операцию с картинками как одно неделимое действие.
      - **«Трансформация фона»** позволяет повернуть и растянуть картинку по всем осям или только по одной из осей. Всё работает через клики левой кнопкой мыши. Точка поворота выбирается первым кликом перед непосредственным поворотом. Для включения/выключения растягивания по той или ной оси надо нажимать по клавишам X или Y. Получившуюся трансформацию фона всегда можно сбросить при клике по соответвующему пункту в контестном меню.
      - **«Сохранять результат в память»** и **«Достать скриншоты из памяти»**. Команды реализуют функционал для частично замены **Прокрутки** из оригинального скриншотера Joxy.
        После активации пункта меню «Сохранять результат в память» в программе активируется специальный режим, в котором все скриншоты после нажатия кнопки «Готово» будут сохранятся в память программы, а не на диск с последующим уведомлением. Вдобавок кнопка «Готово» теперь будет иметь красный цвет, чтобы пользователь не забывал об этом.
        После нажатия кнопки готово нужно проскролить до нужного места то, что собираемся скриншотить и снова вызвать редактор скриншота. Когда все части будут захвачены, их можно будет собрать в один скриншот, вызвав редактор и кликнув в контекстном меню по пункту «Достать скриншоты из памяти». В результате дополнительно будет задана область захвата, отключится чекбокс «Фон» и чекбокс «Сохранять результат в память», и кнопка «Готово» вернёт себе обычный цвет и по нажатию на нёё «Готово» программа сохранит на диск готовый скриншот и покажет уведомление.
        Фича пригодится, когда нужно заскриншотить длинный диалог, который открыт не в браузере (в браузерах есть удобные скриншотеры-расширения)
      - **«Переснять скриншот»**. Всё говорит само за себя.
  - Отладка
    - Теперь дебажный список пометок (в коде пометки это `elements`) может отображаться от положения курсора мышки, если области захвата ещё не задана
  - Теперь можно выбрать включать ли фон скриншота в результат или нет (полезно для коллажей, которым этот фон обычно не нужен)
  - Теперь программа может запоминать размеры и положение области захвата между вызовами. Для этого достаточно лишь кликнуть соответствующий чекбокс внизу панели инструментов
  - Теперь эффект инструмента *Затемнение* накладывается поверх всех пометок, если в контекстном меню выставлен чекбокс «Затемнять после отрисовки пометок»
  - Через **Ctrl+V** теперь всегда вставляется картинка, и не важно выбран ли при этом инструмент **Картинка** (ранее назывался **Штамп**)
  - В контекстном меню сменилась иконка для команды полной остановки программы
  - Среди всех пометок пометки-изображения теперь рисуются в первую очередь, чтобы остальные пометки всегда были поверх них
  - Можно обрезать (кадрировать) пометки-изображения в специальном редакторе, вызываемом из контестного меню. Для этого надо сначала выделить нужную пометку-изображение через инструмент **Перемещение**. Сделано это для того, чтобы иметь возможность обрезать изображения, которые не помещаются на экране, но вообще можно обрезать любые. Область для кадрирования задаётся курсором мыши с зажатой левой кнопкой. Из редактора кадрирования можно выйти нажав клавишу Esc. В редакторе кадрирования можно бесконечно долго переопределять область обрезки заново. Затем, будучи удовлетворённым результатом, надо нажать на Enter. После такой обрезки всегда можно вернутся в редактор кадрирования и изменить такую образку сколько угодно раз. Сбросить обрезку можно через контекстное меню при условии, что пометка-изображение будет выделено инструментом **Перемещение**.

### Версия 0.93 (1 октября 2023)
  - После нажатия кнопки «Готово» теперь принудительно закрываются все открытые окошечки из трея, чтобы программа перезапустилась и, перезапустившись, смогла в дальнейшем обрабатывать сочетания клавиш (по дефолту после первого вызова она перестаёт это делать)
  - Исправлен баг с заблюренной лупой
  - Изменена расстановка пунктов в контекстном меню
  - Через Ctrl+V теперь можно вставлять .svg- и .svgz-файлы в виде картинок
  - Избавился от костыля - переопределения класса QPoint
  - Исправлен баг: курсор изменялся на дефолтный при зажатой левой кнопке мыши при перетаскивании области захвата
  - Исправлен баг: в режиме редактора перестал работать антиальясинг
  - Исправлен баг: после команды «Автоколлаж» не сбрасывался виджет трансформации и панель инструментов не позиционировалась согласно обновлённой области захвата
  - В контекстное меню добавлена галочка «Закрывать редактор после нажатия кнопки Готово». В окне уведомления о созданном скриншоте теперь отображется имя сохранённого файла
  - Теперь режим задания клавиш-модификаторов активируется когда поле комбинации клавиш получает фокус ввода. После того как клавиши будут отпущены, пропадёт фокус и режим задания выключается. Раньше режим активировался при показе и дезактивировался при скрытии окна настроек. Благодаря этому изменению отыне можно сделать скриншот самого окна настроек.
  - Инструмент **Штамп** переименован в **Картинка**. По этому случаю код отрефакторил
  - UX: картинки, добавленные через кнопку **Коллаж** теперь отображаются в обычном масштабе, а не в уменьшенном в два раза как раньше
  - Исправлен баг: теперь не должно быть зазора между картинками после команды **Автоколлаж**
  - Исправлен баг^^: теперь при выборе картинки через инструмент трансформации слайдер размера принимает правильные текущие значения
  - UX: теперь правка параметров размера и цвета пометки через колесо мышки работает только когда при этом курсор мыши находится поверх пометки
  - В контекстное меню добавлена команда «Содержимое в фон». Она рендерит в фоновое изображение все пометки и затем удаляет их так, что их уже не отредатируешь. Действие отменить нельзя. Пригождается когда нужно собрать из картинок-пометок новую картинку через инструменты **Копипейст** и **Лупа**
  - Во вьювере результата (доступен через клавишу P) можно задавать область захвата. После нажатия Enter область будет присовена инструменту **Картинка** для вставки
  - В контекстное меню добавлена команда **Подогнать все картинки по размеру под одну**. Картинка, под которую подгоняется, предварительно выбирается инструментом **Перемещение**, иначе подгонка будет под первую картинку из набора всех картинок. Картинки сдвигаются либо вниз, либо вбок для удобства выделения. Действие отражается в истории действий.
  - Для слайдеров цвета, размера и прозрачности заданы подсказки при наведении курсора мыши на них
  - Добавлен слайдер прозрачности для картинок
  - Исправление исправления бага, помеченного ^^
  - Рамку в просмоторщике картинок теперь можно задавать и изменять с помощью виджета задания области захвата. Всё осталось работать через зажатый Ctrl.
  - Добавлена возможность сохранить и загрузить проект через команды в контекстном меню «Сохранить проект» и «Открыть проект».
    - ЗАОДНО исправил баг: теперь удаление выделенного элемента через клавишу Delete обновляет доступность кнопок истории, которые раньше на это не реагировали
  - Всплывающие уведомляющие диалоговые окна (через клавишу Esc, после сохранения и загрузки проекта) теперь плавно меняют цвет заливки заднего фона, чтобы быть более заметными на фоне общей цветовой каши.
  - Команда «Содержимое в Фон» теперь учитывает ситуацию, когда содержимое по габаритам может превосходить фоновую картинку, и, поэтому предлагает расширить её, чтобы в результате не было нежелательных обрезок контента
  - Теперь через Ctrl+V можно вставлять кадры из анимированные webp- и gif-файлов, предварительно выбрав нужные кадры и их выставив нужную обрезку
    - можно включить/выключить воспроизведение анимации через Пробел
    - клавиши Влево и Вправо позволят перелистывать кадры
    - через колесо мыши и зажатые Ctrl+Shift можно задавать скорость
    - через зажатую левую кнопку мыши и вращение колеса мыши можно перелистывать кадры
    - включить или исключить картинку из кадра можно через Enter (при включении картинка не обрезается)
    - выбрав нужные кадры нужно нажать Ctrl+Enter
    - кадры вставятся сразу как картинки либо через инструмент Картинки (первая будет выставлена в инструмент, остальные же поместятся в магазин, откуда они будут изыматься по мере клика левой кнопкой мыши)
  - Во встроенном вьювере контестное меню заменено на удобную нижнюю панель с кнопками в виде иконок. Эта панель практически полностью скопирована с такой же панели в Image Viewer. В контестном меню осталась лишь команда **Закрыть**
  - Для встроенного вьювера работает справка через кнопку на нижней панели или через клавишу F1
  - Во встроенном вьювере кнопки поворота картинки поменяны местами
  - Во встроенном вьювере можно отражать картинку и по вертикали, для этого нужно лишь зажать Ctrl перед нажанием клавиши M
  - Во встроенном вьювере появилась возможность трансформировать (вращение, масштабирование) картинку и каждый фрейм отдельно у анимированной картинки
      - примечание: для того, чтобы фрейм из анимационного файла экспортнулся в OXXXY, надо задать ему рамку размером с него самого с помощью Ctrl+Enter
  - Во встроенном вьювере обновлена отрисовка двух кнопок
  - Виджет трансформации теперь умеет в пропорциональное масштабирование, что как раз пригодится для картинок, и для активации достаточно зажать Ctrl. Для квадратных размеров надо зажимать Ctrl+Shift
  - Пофиксил баг: после использования инструмента, который делает картинку из пререндера, при последующем запуске клик по любой области выдаёт вылет, но перед вылетом показывается менюха превьюшек.
  - Скороллбар у меню инструмента **Картинка** стилизован под общий визуальный стиль программы

### Версия 0.94 (дата не определена)
  - Отрефакторил do_scale_image во встроенном просмоторщике согласно изменениям в донорском приложении Krumassan Image Viewer
  - pyperclip больше не нужен
  - внедрение Panning & Zooming для холста в редакторе
      - ДЕТАЛИ
          - отрисовка всего за счёт вычислений на основе опорного ориджина и величины скейла холста по двум осям
          - координаты мыши должны мапится из координат вьюпорта в координаты холста, учитывая скейл и положение опорного ориджина
      - прописал основные переменные и функции
      - отрефакторил так, чтобы программа хотя бы запускалась
      - перемещение холста (panning) теперь работает через зажатое колесо мыши
      - зум холста (zomming) работает через колесо, **пока колесом нельзя менять параметры инструментов как раньше**
      - теперь рамка захвата адекватно отрисовывается во время zooming и panning
      - восстановлено перемещение рамки захвата (эта функция доступна, когда не выбрано ни одного инструмента)
      - восстановлено обновление курсора мыши для областей, образуемых касательными линиями проведёнными к прямоугольнику области захвата
      - восстановлено автопозиционирование панели инструментов в зависимости от зума и смещения
      - восстановлено изменение границ рамки захвата через мышь
      - удалён легаси-код виджета трансформации
      - удалён легаси-код трансформации фона (фон будет представлен картинкой, которую можно трансформировать как вздумается)
      - фоновое изображение (скриншот) теперь исполнено в виде пометки-изображения
          - заодно пришлось очень много рефакторить
      - восстановлена корректная отрисовка дебажной превьюхи результата
      - восстановлена корректная отрисовка списка элементов в дебажном режиме
      - восстановлен рендер финальной картинки
      - появилась возможность зумить холст когда область захвата ещё не задана, для этого нужно удерживать Alt
      - вроде как теперь восстановил функциональность лупы
      - зум при зажатом Alt работал только в одну строну из двух возможных, поэтому пришлось заменить Alt на комбинацию Shift+Ctrl
      - исправил позиционирование лупы при zooming и panning для случая, когда область захвата ещё не задана. Вдобавок ушли баги, проявляющиеся *во время задания* области захвата
      - автоматическое позиционирование панели инструментов теперь работает и при переносе холста (panning)
      - в контекстное меню добавлена галочка для отключения фона
      - подправил лупу, чтобы она выдавала нужное значение цвета при задействованном зуме (zooming) и смещении холста (panning)
      - автоматическое позиционирование панели инструментов теперь работает и при зуме холста (zooming)
      - поправил переключение режимов прозрачности фона через клавишу TAB. **Когда фон можно будет свободно трансформировать и фон будет выходить за рамки экранов, надо будет просмотреть насколько адекватно всё отрисовывается и внести правки по наобходимости**
      - изменение управления: зумить холст (zooming) можно теперь ещё и при отображающиейся лупе с помощью одного колеса, а чтобы зумить саму лупу теперь надо зажимать ctrl и крутить колесо
      - рефакторинг: избавился от legacy-переменной `elements_global_offset`
      - рефакторинг: избавился от legacy-переменной `background_transformed`
      - рефакторинг: вынес описание класса Element из метода миксина
      - рефакторинг: избавился от legacy-переменных с префиксом `f_`
      - при рефакторинге забыл задать смещение финальной отрисовки на координаты верхнего левого угла области захвата, из-за чего область захвата съезжала к началу координат в левый верхний угол
      - в режиме дебага (`DEBUG=True`) больше не отображается оверлей результата. Посмотреть на то, что в данный момент получается в чистовом виде можно нажав на клавишу P (оверлей отключается повторным нажатием клавиши)
      - фикс краша: клавишу P не отображал результат без заданной области захвата
      - написал маппинг координат курсора мыши во время клика на координаты холста во время нанесения пометки
      ---------------------- 2024 ----------------------
      - отрисовка элемента для инструмента line переписана так, чтобы отражать перемещение, повороты и масштабирование пометки (элемента) при всём этом реагируя на перемещение и масштабирование вьюпорта. До этого поддерживалось лишь перемещение вьюпорта и перемещение пометки
      - через инструмент Трансформация реализовано выделение и перетаскивание пометок, пока только для пометок типа Линия. Заодно частично удалён старый код
  - внезапная фича: в панели управления теперь можно поставить галочку, из-за которой будет рисоваться курсор на скриншоте
  - внедрение Panning & Zooming для холста в редакторе (продолжение)
      - через инструмент Трансформация реализовано вращение пометок (пока только для пометок типа Линия)
      - через инструмент Трансформация реализовано масштабирование пометок (пока только для пометок типа Линия)
      - добавлен код обработки отпускания кнопки мыши (который я забыл добавить сразу)
      - теперь доступна отмена трансформаций в процессе через клавишу Esc
      - проверена адекватная трансформация в процессе зумирования вьюпорта
      - проверена возможность выделять пометки прямоугольником, задаваемым курсором мыши
      - вернул вызов функции elementsSelectedElementParamsToUI после работы функции выделения. Теперь, если выделено больше чем одна пометка, то контролы настройки пометки на панели управления прячутся
      - восстановлена работа метода elementsSetSelected для выделения единственной пометки или сброса имеющегося выделения, дополнительно вычищен код от демонов прошлого
      - теперь как и раньше сбрасывается выделение, если выбирается другой инструмент
      - вернул возможность циклического выделения перекрывающих друг друга пометок в позиции курсора мыши: фича теперь работает при зажатой клавише Ctrl, без неё сделать не получилось, потому что код циклического выделения всегда конфликтовал с кодом начала перетаскивания, который учитывает случай, что перетаскивание может начаться над невыделенной пометкой
      - пока отключено выделение картинки, которая составляют сам скриншот. Позже её можно будет включить через контекстное меню. Плюс вычистил код от багов, которые быши внесены попыткой сделать циклическое выделение без использования зажатой клавиши Ctrl
      - перенесены курсоры для масштабирования и вращения виджета трансформации
      - дебажная отрисовка виджета трансформации отключена за ненадобностью, ведь курсор мыши теперь подскажет где и какая трансформация активируется. При желании дебажную отрисовку можно включить в контестном меню
      - проверил работу клавиш-модификаторов в поворотах и масштабированиях
      - переделал активацию циклического выделения
      - восстановлена работа галочки «Обтравка»
      - восстановлена работа галочки «Трети»
      - восстановлена работа галочки «Запомнить захват»
      - восстановлена работа инструментов «Карандаш» и «Маркер», оба поддерживают новое выделение, собственные трансформации и pan & zoom
      - восстановлена работа инструмента «Стрелка» с поддержкой нового выделения, собственных трансформаций и pan & zoom
          - **виджет перестаёт работать, если стрелка вытянута строго по вертикали или горизонтали** (ошибка деления на ноль)
      - **пропускаю восстановление инструмента «Текст», там нужно будет заменить виджет и переписать нанесение, отрисовку, выделение и трансформацию**
      - восстановлена работа инструмента «Овал» с поддержкой нового выделения, собственных трансформаций и изменения вьюпорта
      - восстановлена работа инструмента «Прямоугольник» с поддержкой нового выделения, собственных трансформаций и pan & zoom
      - восстановлена работа инструмента «Нумерация» с поддержкой нового выделения, собственных трансформаций и pan & zoom
      - восстановлена работа инструмента «Размытие» с поддержкой нового выделения, собственных трансформаций и pan & zoom
      - восстановлена работа инструмента «Затемнение» с поддержкой нового выделения, собственных трансформаций и pan & zoom
          - благодаря трансформациям пометки теперь можно задавать области затемнения с поворотом
      - **поздней будет переделан инструмент «Размытие», чтобы поддерживать области с поворотом**
      - восстановлена работа инструмента «Затемнение» с поддержкой нового выделения, собственных трансформаций и pan & zoom
          - инструмент активируется через контекстное меню
      - продумал детали новой реализации истории пометок
          - теперь история будет реализована через массив объектов THistoryRecord, каждый из которых будет иметь массив пометок Element размером от одного (для обычных пометок), до двух (для пометок инструмента Лупа и Копипейст), и до нескольких (для версий пометок, созданных с помощью инструмента Трансформация, ведь выделять можно несколько объектов, соответственно эти несколько объектов будут изменены единовременно и в истории изменений должны идти вместе)
          - удобная сериализация всего этого дела для сохранения на диск и чтения проектного файла 
