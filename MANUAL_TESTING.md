## Программа рукопашного тестирования Oxxxy перед релизом

Перед тестированием:
- удалить файл settings.json для пользовательского режима
- удалить файл crash.json для пользовательского режима
- перенести файлы в другую папку и в ней тестировать (использовать скрипт `test delivery.py`)

Основное и общее:
- сочетания с клавишами букв должны срабатывать на любой раскладке (т.е. в коде обработки нажатий на клавиши должны использоваться скан-коды)
- запустить launcher.pyw. После запуска в трее должна появится иконка приложения.
  - приложение должно реагировать на комбинации клавиш
    - Ctrl+PrintScr - сделать скриншот фрагмента с запуском редактора пометок с заданием области захвата 
    - Ctrl+Shift+PrintScr - сделать скриншот всего экрана или всех экранов с запуском редактора пометок и предзаданием области захвата на весь экран или все экраны 
    - Shift+PrintScr - быстрый скриншот всего экрана или всех экранов без запуска редактора. В таком случае появится только информационное окно около трея
  - приложение должно реагировать на левый клик мыши по иконке в трее - и запускать редактор пометок с заданием области захвата
  - приложение должно реагировать на правый клик мыши по иконке в трее - и показывать окно с инфой и кнопками в углу нижнем правом углу монитора
    - все кнопки должны работать как положено
      - кнопка Выход
        - приложение не должно перезапускаться, если нажата эта кнопка

Режимы редактора:
- режим первоначального задания области захвата
  - доступность справки через клавишу F1
    - проверить работоспособность всех описаний в справке
    - должно быть доступно точное управление курсором с помощью клавиш-стрелок и клавиши Enter для первоначального задания области захвата
  - при подходе ко краям и углам экрана лупа должна правильно позиционироваться из-за недостатка свободного места для своего обычного положения 

- режим редактирования пометок и эффектов (с возможностью многократного изменения области захвата)
  - наводить на каждый инструмент до появления подсказки и вручную проверять реальное соответствие подсказке
  - редактор области захвата
    - курсор мыши должен изменяться в зависимости от того, в какой из прилегающих к захваченной области зон он относится
    - выбранный инструмент должен деактивироваться при повторном нажатии на его иконку
      - если на панели не выбран ни один инструмент, то при перемещении курсора с зажатой левой кнопкой мыши внутри области захвата должна перемещаться сама область захвата, а не одна или две её границы
    - должны работать и корректно отрисовываться режимы отображения незахваченной области через Tab/Tab+Shift
    - накладываемые пометки должны затемнятся в зонах НЕзахвата
    - рисование пометок должно начинаться только внутри области захвата, но может быть завершно в зонах НЕзахвата
  - особенное внимание надо уделить инструменту **Перемещение** в связке с историей создания пометок (пометки в коде названы `elements`). Инструмент **Перемещение** должен активироваться через клавишу Пробел
    - пытаться менять доступные параметры пометок и эффектов
    - пытаться менять положение пометок и эффектов через виджет
      - пытаться менять положение виджета с помощью стрелок на клавиатуре и клавиши Shift для перемещения на большую величину
      - констрейнт 45 градусов через клавишу-модификатор (для Линия, Стрелка, Текст со стрелкой)
      - констрейнт квадрата: одинаковое расстояние сторон прямоугольника виджета при зажатии клавиши-модификатора
      - кнопки мышки
        - выделение пометки срабатывает при отпускании кнопки мышки
        - перетаскивание пометки срабатывает при нажатии кнопки мышки
      - должна создаваться копия элемента, если его виджет двигать мышкой или перемещать через стрелки на клавиатуре (проверяется в режиме дебага)
      - виджет на пометке или эффекте должен исчезать, если выбирается другой инструмент
      - рисовать линии, стрелки и прочее в оба направления по диагоналям воображаемого прямоугольника и затем масштабировать их виджетом через переброс угловой или рёберной точки за противолежащую точку. Ничего не должно внезапно флипать/менять ориентацию
    - для пометки Текст
      - редактировать текст, текст должен автоматически переносится, если он вылезает за пределы области захвата
      - должен вращаться с помощью клавиш F5 и F6 (без стрелки)
      - переключать галочку подложки и смотреть реакцию
      - крутить слайдеры цвета и размера
      - перемещать с помощью виджета трансформации
      - при изменении через инструмент Перемещение стрелка должна начать стремится к середине пометки с текстом
    - пометки инструмента Нумерация должны выделяться мышкой, если они нанесены без сопровождающей рамки
    - параметры
      - включать/выключать галочку между слайдерами цвета и размера, если она доступна для инструмента или пометки
      - менять цвет в слайдере цвета, если он доступен для инструмента или пометки
      - менять величину в правом крайнем слайдере, если он доступен для инструмента или пометки
    - ходить туда-сюда по истории пометок
      - (в режиме дебага) отслеживать статус во время разных действий, в том числе при удалении пометки через Delete
      - проверить работоспособность сочетаний Ctrl+Z - шаг назад, Ctrl+Shift+Z - шаг вперёд
  - инструмент **Картинка** (ранее назывался **Штамп**)
      - окно списка штампов (меню штампов)
        - когда окно списка штампов открывается НА ВТОРОМ экране, то оно должно появится НА ВТОРОМ, а не на первом
        - проверить позиционирование окна в условиях близости иконки инструмента Штамп ко краям и углам экрана
        - адекватная реакция окна на разное количество стикеров
        - на время загрузки превьшки вместо неё должна обтображаться надпись Loading, а если что-то пошло не так, то с надписью BROKENs
        - скрывать окно выбора штампа при клике за область окна или при выводе курсора за область окна или при нажатии Esc с открытым окном
      - нужно запоминать штамп при сохранении скриншота и подгружать его при последующем старте редактора, если в прошлый раз пользовались Штампом перед сохранением скриншота (если выбранный штамп не из файлового диалога или из буфера обмена)
      - у штампов должен меняться размер при его изменении через слайдер размера в инструменте Перемещение и должен обновляться виджет
      - поворот картинки через Ctrl+Wheel (+Shift)
      - через Ctrl+V вместо выбранного штампа должна вставляться картинка из буфера обмена
        - слишком большие пикчи должны подгонятся по высоте под высоту области захвата на момент нажатия Ctrl+V
  - инструменты Лупа и Копипейст
      - проверить, что во время двухэтапного ввода данных нельзя было сменить инструмент и впринципе взаимодействовать с панелью инструментов
  - при нажатии клавиши Esc должен появиться подтверждающий диалог для отмены создания скриншота (и выхода из редактора)
      - Esc на выход из программы должен срабатывать, даже если какие-то кнопки были нажаты на панели инструментов или панель была перемещена вручную (тест на потерю фокуса ввода)
  - приложение должно запоминать выбранный инструмент и все параметры его и других инструментов
      - в рамках текущего вызова редактора
      - для последующих вызовов редактора, но вся такая информация сохраняется только если скриншот был создан
  - проверить работу всех галочек и их применение на финальном результате
      - проверить работу в режиме редактора и в готовом скриншоте
      - в области захвата должно быть видно включение/отключение гексагональной обтравки через клавишу H при включённй галочке Обтравка
  - панель инструментов
      - панель инструментов должна автоматически позиционироваться в зависимости от свободного пространства, но в рамках сессии должна перестать это делать, если её вручную подвигали
      - иконки инструментов в панели инструментов должны реагировать на нахождение мышки над ними специальной отрисовкой
      - некоторые иконки должны реагировать на зажатие Ctrl и отрисоваться закрашенными
      - слайдеры должны срабатывать на нажатии кнопки мыши, а не при отпускании
      - если меняется размер или цвет через слайдер, то эти изменения должны отражаться на пометке только если тип текущей пометки совпадает с типом текущего выбранного инструмента и пометка или эффект были созданы ТОЛЬКО ЧТО
- в обоих режимах должно быть доступно контекстное меню, все пункты которого должны работать исходя из названия

После выхода из редактора:
- после успешного создания скриншота около трея должно появится информационное окно
  - в нём должно работать три кнопки:
    - открыть скриншот в браузере
    - открыть скриншот в программе просмотра изображений по-умолчанию
    - открыть папку со скриншотами
  - окно должно автоматически закрываться по истечении определённого времени, если над окном не пролетал курсор мыши
  - окно должно закрываться при нажатии на все три кнопки и при нажатии кнопки в углу
- если путь для сохранения скриншотов не задан, то приложение должно зацикленно спрашивать его до тех пор, пока наконец путь не будет задан
- после сохранения скриншота или отмены его создания приложение должно перезапуститься


Проверка на баги для версии 0.92
  - режим коллажа (или расширенный режим)
    - адекватно должна работать история действий после добавления всех картинок
    - UX: mouse panning через Alt должен работать из всех 9ти секторов, порождаемых касательными к области захвата, а не только из центрального
    - при входе и выходе из этого режима должны адекватно отрабатываться область захвата и общий сдвиг, а при выходе из режима последние должны вернутся в привычное место
    - паннинг через Alt не должен быть доступен, если расширенный режим выключен
    - при глобальном сдвиге должны сдвигаться область захвата, все пометки и редактор текста от пометки типа **Текст**
  - общее
    - процесс должен закрываться, если процесс запущен в режиме уведомления в независимости нажата кнопка «закрыть» или нет
  - настройки
    - задаваемые горячие клавиши не должны срабатывать пока открыто окно настроек
      - !!! во время тестирования нужно всегда гасить главную открытую копию приложения, иначе эта копия захватит себе все тестируемые комбинации клавиш
  - сделать коллаж из некольких картинок
    - заводить некоторые картинки через сочетание клавиш Ctrl+V
  - проверять адекватность редактора кадрирования
  - сохранение и загрузка проекта
      - протестить сохранение и загрузку на корректность по следующим пунктам
          - глобальный сдвиг
            - после открытия файла пробовать паннинг через alt+кнопка мыши
          - пометки-картинки
          - обрезанная пометка-картинка
            - после открытия пробовать восстановить необразанную версию
          - трансформированный задник
          - текстовый элемент и его инициализация
              - попробовать добавить текстовой элемент в середине или самым последним
  - фича трансформации картинки во вьювере
      - проверка задания и сброса трансформации
          - для случая анимации (вставка анимационного файла)
          - для случая создания штампа из пререндера (клавиша P)
          - для случая редактирования изображение (через контекстное меню)


Проверка на баги для версии 0.95
  - рисование курсора поверх скриншота при включенной галочке
  - трансформации пометок
      - отмена любой трансформации через клавишу `Esc`
      - возможность зумить холст по время трансформаций
      - вращение пометок вокруг противоположного угла
      - при отмене трансформации картинка должна возвращаться в прежнее место. Легко это проверять на подразделёном фоне, тогда баг обнаруживает себя из-за просветов слишком большой ширины
      - пометки с предвращением должны нормально вращаться с шагом в 45 градусов
  - выделение пометок
      - выделение резиновым прямоугольником
      - выделение одинарным кликом
      - одинарное циклическое выделение (с зажатым `Ctrl`)
      - выделение при зажатии кнопке мыши и последующем перетаскивании невыделенной пометки с зажатой кнопкой мыши
      - при выделении резиновым прямоугольником не должны размножаться модификации одной пометки
  - курсор мыши должен устанавливаться сообразно выполняемому типу трансформации, а также устанавливаться в зонах активации (перемещение, масштабирование, вращение)
  - галочка «Запомнить захват»
  - инструмент «Лупа»
      - проверить правильность отрисовки выпуклой оболочки для прямоугольников и касательных линий для кружков, трансформация кружков
      - правильность отрисовки образа второй пометки при нанесении
      - пропорциональное масштабирование для второго элемента инструмента лупы по дефолту если этот второй элемент выбран
  - фонозависимые пометки и функция извлечения повёрнутой зоны 
      - проверять на прозрачные поля при поворотах близких к 90 и к 45 градусам
      - не должно быть багов при изменении масштаба пометки
      - изменение картинки при трансформациях фона
  - инструмент «Картинка»
      - вставка одной картинки
      - вставка серии картинок через магазин
  - команды
      - «Переснять скриншот»
  - удаление выделенныхпометок через клавишу `Delete`
      - если удаляется пометка из двухкомпонентной пометки, то удалять надо и вторую
  - инструмент «Мультикадрирование»
      - должен поддерживать повёрнутые области захвата в выходном изображении
  - пометки инструмента «Размытие» должны брать затемнённую картинку, если инструмент «Затемнение» был применён
  - фильтрация кандидатов для выделения: описать подробнее
  - редактор обрезки картинки во вьювере: при первом и последующем вызове должно функционировать перезадание рамки обрезки
  - адекватность возможности отключения рамки захвата на уровне управления, чтобы можно было работать с выделением объектов (влияет и на курсоры)
  - `Ctrl+A`команда снять выделение или выделить всё
  - клавиша `F` и сочетание `Ctrl+F`: увеличивает выделенные пометки в максимальном масштабе и центрирует вьюпорт на них, сочетание делает то же самое, но с областью захвата
  - сохранение и загрузка проектного файла учитывая наличие новых пометок, проверка формата записи CBOR2
  - при активации инстурмента «Выделение и Трансформация» не должен выделяться фон, так как фильтр настроен на пометки
  - проверить контекстное меню у окна в трее: для перезапуска и тестового краша приложения
  - слоты модификации
      - перемещение выделенной пометки или выделенных пометок через клавиши-стрелки
      - перемещение, вращение и масштабирование через зажатую кнопку мыши
      - изменение слайдеров и флажков на панели управления (размер, цвет, прозрачность)
      - все выделенные пометки должны попасть в один слот модификации
      - пометки инструментов «Лупа» и «Копипейст» должны адекватно реагировать на модификации
  - сбрасывание файлов на окошко в трее для активации редактора коллажей
  - для нанесённых вытянутых пометок должно задаваться предвращение
  - пометки инструмента «Текст»
      - курсор рисуется только если пометка является активной
      - деактивация через клавишу `Escape`
      - размер шрифта задаётся через слайдер на панели управления
      - клавиша `Backspace`
      - возможность писать прописными буквами с помощью зажатого `Shift`
      - поддержка перемещения курсора через клавиши `Влево` и `Вправо`
      - вставка из буфера обмена через сочетание `Ctrl+V`
      - должна быть возможность перенести пометку Текст или другим образом её трансформировать, если она активна


## Рефакторинг и рекомендуемые параметры для Pylint

```
pylint _utils.py --disable=E0611,C0115,C0103,C0116
pylint oxxxy.py --disable=E0611,C0115,C0103,C0116
```
