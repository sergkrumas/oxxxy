
# [Russian] Oxxxy Screenshoter v0.9 for Windows by Sergei Krumas

![](docs/oxxxy_logo.png)

**Oxxxy Screenshoter — неофициальный и неполный опенсорсный клон программы Joxi для создания скриншотов с отсебятиной от Сергея Крумаса**

## Спасибо, что выбрали Oxxxy!

По моему мнению, Oxxxy — лучший инструмент для создания скриншотов когда
- документируешь программное обеспечение под NDA
- ведёшь важные переговоры в сети
- составляешь техническое задание

Если у вас возникли какие-либо вопросы или проблемы в работе программы, вы всегда можете описать вашу проблему в специальном разделе Issues. Возможно вам даже помогут, но это неточно. Ведь вы получили этот продукт по условиям GPL, которая ни к чему не обязывает.

## Лицензия

Весь исходный код выпущен под GNU GPL Version 2

## Мотивировка

Зачем, а главное — nahuya я написал копию популярного скриншотера и назвал его Oxxxy? Причины следующие:
- оригинальный скриншотер Joxi сразу посылает все созданные скриншоты на свой сервак, что очень удобно для обычных пользователей сети делящихся скриншотами с другими пользователями. Но это совсем недопустимо, когда ты как разработчик пользуешься им на работе и подписываешь всякие там NDA или что-то подобное. Сохранение скриншота на компьютер в Joxi конечно реализовано, но программа каждый раз спрашивает место для сохранения файла, что уже давно вымораживало;
- при частом использовании Joxi падает;
- патчить недостатки Joxi побайтово и раздавать пропатченную версию всем моим корешам/корешессам является незаконным в РФ, ЕС и США;
- возможность спонтанно добавлять в программу инструменты для нужных пометок и эффектов. При написании документации к разрабатываемому софту именно нанесение пометок является очень рутинным делом. Поэтому постоянно назревала идея облегчить мучения за счёт своих навыков программирования и доступного исходного кода, который теперь существует в природе и доступен не мне одному;
- наносить пометки в тяжеловестных приложениях типа Photoshop или GIMP долго и утомительно;
- нужен был проект для углублённого изучения PyQt;
- ещё будучи неготовой для публичного релиза прога часто пригождалась в личных и важных переговорах.

## Языки интерфейса

- только Русский

## Требования

- Операционная система: Windows 8.1 или Windows 10. На Windows 11 не тестировалось, на Linux в данный момент пользоваться невозможно (подробности ниже в специальном разделе)
- Уметь самостоятельно установить Python нужной версии и работать с командной строкой для установки зависимостей через встроенную в Python утилиту **pip**
- Версия Python: 3.10.6 и выше.
- Установка всех зависимостей через утилиту **pip**, прописанных в файле **install_deps.bat**

### Зависимости
ВАЖНО: Необходимо, чтобы pynput обязательно был именно указанной здесь версии, ибо в 1.7.6 он почему-то не распознаёт нажатие на клавишу Print Screen и, собственно, поэтому все горячие клавиши работать не будут ВОЩЕ. Зарепортить баг мне было лень, поэтому я просто поставил старую версию, хехе.
Вдобавок пользователям Linux хорошо было бы ознакомится с этим https://pynput.readthedocs.io/en/latest/limitations.html

## [Установка, запуск приложения и описание возможностей](OVERVIEW.md)

## Что будет в следующих версиях?

- рефакторинг кода
- переход с PyQt5 на PyQt6 
- оформлю программу в отдельный python-модуль для встраивания в любые PyQT-приложения
- будет возможность делать пометки на любых картинках из проводника Windows
- для UI добавятся ещё три языка кроме Русского: Немецкий, Французский и Английский
- переделаю виджет для инструмента **Текст**, чтобы в режиме редактирования при повороте через клавиши F5-F6 одновременно с основной не отображалась повёрнутая версия
- выделение объектов для инструмента **Перемещение** будет реализовано намного аккуратней, а не по bounding box объекта как сейчас
- возможность записывать видео со звуком или гифки в захваченной области
- тест и обеспечение работы в виртуальном окружении
- возможность менять комбинации клавиш. Текущие комбинации очень удачно подобраны, поэтому нет острой необходимости их менять сейчас
- версия приложения в виде единого бинарника для Windows и Linux
- возможность менять размеры шрифтов в интерфейсе

## [Changelog](CHANGELOG.md)

## [Ручное тестирование](MANUAL_TESTING.md)

## [Туториал по созданию нового инструмента](TUTORIAL.md)

## Интересные факты

- разработка велась исподволь с июня 2021 года по май 2022 года, бетатестирование с мая 2022 по середину декабря 2022
- под конец работы над этим проектом при исследовании файлов скриншотера Joxi внезапно обнаружилось, что он тоже написан с использованием Qt, только уже на C++
- *производительность или зачем писать Qt-приложения на Python*: если б я писал это всё на C++, то, чувствую, что провозился ещё дольше. На Python пробовать, разрабатывать и отлаживать проще, удобней и быстрей. Ну и, если представить меня, автора кода и автора идеи, в виде пары пользователь+программист, то практичный пользователь однозначно взял верх и ему глубоко насрать как оно там внутри, главное ведь работает же! Ну и пока Oxxxy это не то приложение, в котором производительность играет серьёзную роль.
- отличия от оригинала:
   - клон не умеет делать скриншоты с прокруткой
   - созданный скриншот не отравляется никуда, тем более не предусмотрена даже интеграция с каким-либо из облачных сервисов для хранения изображений и файлов
   - нижняя панель под панелью инструментов не скрывается под неё
   - кнопка **Готово** чуть меньшей высоты, чем сама панель инструментов

## Замечания

### Файл `start_editor.pyw`

Позволяет сразу запустить редактор скриншота и не отслеживает нажатие горячих клавиш. После успешного создания скриношта покажет информационное окно около трея. Перезапускаться, то есть висеть в трее — не будет. Этот файл нужен был для одного хитрого дела — создания скриншотов самого скриншотера Oxxxy.

### Режим дебага

Запуск файла с расширением **.pyw** не даёт Python-у создать совсем ненужное в пользовательском режиме консольное окно, которое потребуется только при разработке.

При разработке/доработке/отладке нужно запускать `oxxxy.py` — файл с расширением **.py**. Во вспомогательных функциях `request_fullscreen_capture_region` и `request_elements_debug_mode` заданы необходимые режимы для упрощения и ускорения процесса отладки. Также обратите внимание откуда они вызываются в коде. Все эти вызовы можно закомментировать при необходимости.

Если выставить переменную `DEBUG_ELEMENTS = True`, то после запуска файла `oxxxy.py` на экране сразу появится панель пометок и эффектов с предзаданной областью захвата. 
  
В режиме дебага (`DEBUG = True`) слева от захваченной области появляется список элементов (пометок+эффектов), а справа от неё будет выводится предварительный финальный результат, который будет сохранён после нажатия кнопки **Готово**. Этот предварительный результат обновляется только когда кнопка мыши отпускается.

### Упрощённая схема режимов работы

![](docs/oxxxy_low_dpi.png)

### Варианты выбора момента перезапуска для повторного вхождения в режим ожидания

- *когда приложение вошло в режим редактирования*. Этот вариант даёт запускать сколь угодно много редакторов при этом уже находясь в редакторе;
- *когда приложение вышло из режима редактирования ПЕРЕД сохранением картинки на диск*. Этот вариант позволяет перезагрузить сразу без ожидания сохранения на диск;
- ***когда приложение сохранило картинку на диск или произошла отмена***. Текущий вариант.

### Информация о крашах

После каждого краша *в режиме дебага* в корневую папку приложения в файл `crush.log` будет скопирован Python-овский трейсбэк. После его прочтения сразу будет понятно что, как и где навернулось. Так программисту легче понять что произошло, а пользователям легче зарепортить баг, просто отправив программисту этот файл. Новые краши не стирают информацию о старых крашах в файле.

В пользовательском режиме файл `oxxxy_crush.log` будет лежать в папке текущего пользователя. Просмотреть его можно будет через специальную кнопку в меню трея — она появится, если этот файл есть и только после краша программы:

![](docs/7.png)

### Файл настроек `settings.json`

В режиме дебага файл хранится в корневой папке приложения, к которой у скрипта должен быть доступ на чтение и запись. Для изменения расположения потребуется править метод `__init__` класса `SettingsJson` в файле `_utils.py`

В пользовательском режиме файл `oxxxy_settings.json` будет лежать в папке текущего пользователя.

### Иконки панели инструментов

Все эти иконки создаются на старте с помощью кода и не загружаются из файлов. Они завязаны на один и тот же размер в пикселях, а это значит, что увеличивать их размер можно только через увеличение уже созданной картинки, хранящейся в памяти.

### Иконка в трее

Категорически запрещается удалять из корневой папки приложения файл `icon.png`, переименовывать или перемещать его, если вы не понимаете что делаете, и вообще хотите увидеть иконку приложения в трее и вырубать приложение через неё, а не через Диспетчер задач.

### Не баг, а фича

Изначально курсор отрисовывался белым цветом с прозрачностью 50%, но после продолжительного использования программы было решено сделать так, чтобы при движении курсор переливался красным, зелёным и голубым, дабы зрительно на фонах разного цвета его можно было легко отслеживать, в том числе и на белом фоне скриншота, а также, например, во время работы приложения для защиты глаз f.lux.

### Flat Design для панели инструментов

В файле `oxxxy.py` есть переменная `FLAT_EDITOR_UI`. Если выставить её в `True`, то с панели инструментов исчезнут градиенты и прочие украшательства:

![](docs/shaded_vs_flat.png)

## Рекомендуемые параметры для Pylint

```
pylint _utils.py --disable=E0611,C0115,C0103,C0116
pylint oxxxy.py --disable=E0611,C0115,C0103,C0116
```

Для проверки кода можно запускать `run_pylint.bat`.

## Попытки протестить прогу на разных Линуксах в ограниченное время (10 декабря 2022)

### Fedora (версия от 2021 года)

Старый ноут с Fedora был в пределах досягаемости и я решил поэкспериментировать.

Сначала не захотел устанавливаться модуль **pynput**, но я решил [проблему](https://stackoverflow.com/questions/21530577/fatal-error-python-h-no-such-file-or-directory) с помощью команды
```
sudo dnf install python3-devel
```
Уже потом, запустив Oxxxy при импорте модуля **pynput** Python рассыпался на множественные эксепшены, среди которых по-английски было написано, что платформа не поддерживается. В итоге **Oxxxy** всё-таки удалось запустить, предварительно выпилив все связи с **pynput** — таким образом возможность отслеживания нажатия сочетаний клавиш полностью отвалилась на Fedora.
И кстати, трея для иконок приложений в Fedora изначально нет. Поэтому так как посредством трея и сочетаний клавиш редактор скриншота не вызвать, то пришлось запускать ***Oxxxy*** прописав в коносли `python start_editor.pyw`.

При первом запуске возник единственный гейзен-баг — снимок в редакторе содержал непонятный глитч-мусор вместо изображения. Со второго раза баг куда-то пропал. Функция "Переснять скриншот" из контестного меню работала неправильно, а именно: был захвачен интерфейс самого скриншотера, чего быть не должно, ведь он должен быть скрыт на момент пересъёмки.

В остальном все тулзы панели инструментов отрабатывали как и должны. 

### Другие Линухи: Linux Mint 21 Cinnamon, Linux Ubuntu 22.04, Linux Mint 21 Xfce

- чтобы некоторые кнопочки работали под Linux вот это `os.startfile` надо будет заменить на это
```python
      import os, sys, subprocess
      def open_file(filename):
          if sys.platform == "win32":
              os.startfile(filename)
          else:
              opener = "open" if sys.platform == "darwin" else "xdg-open"
              subprocess.call([opener, filename])
```        
- про `explorer.exe` Linux тоже ничего не знает, хотя это очевидно, я просто недоглядел
- нигде не работают отслеживаемые сочетания клавиш, а по некоторым срабатывают встроенные скриншотеры
- на Linux Mint 21 Cinnamon по правому клику в трее выскикивает непонятный белый столб вместо окна, и в процедуру обработки клика по иконке в трее даже не передаётся управление
- в Ubuntu под виртуалкой консоль открыться не смогла, в итоге я не стал разбираться с причиной и забил на Ubuntu
- Linux Mint 21 Xfce внезапно не поддерживается модулем pynput, стало известно только при запуске приложения
- везде, кроме Ubuntu, `start_editor.pyw` работал исправно
- позже всё-таки удалось решить проблемы с Ubuntu. PyQt5 пришлось устаналивать специально и не только для Python, а вообще фундаметально для всей системы и тогда прога начала запускаться. Иконка появилась в системном трее, но была совершенно некликабельна и [эта проблема существует уже давно](https://forum.qt.io/topic/108053/qsystemtrayicon-signals-not-emitting-on-mouse-click-in-ubuntu-19-04), но всем просто насрать и размазать. `start_editor.pyw` запустился, но с серьёзным глюком отрисовки, а вместо скриншота была чернота. Даже запуск из под root не развеял черноту.  

#### Итоги вылазки на Linux

Linux ясно дал мне понять, что мой скриншотер ему не нужен и что PyQt, к сожалению, оказался не таким уж и кроссплатформенным и, получается, что полноценно работает только на Windows. Pynput тоже удивил. Хотя до этого я полагал, что всё пойдёт как по маслу.

Ну что же, оставим на потом версию для Linux и проблемы всех его многочисленных оболочек.
